From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jesse Gross <jesse@ollama.com>
Date: Thu, 24 Apr 2025 14:48:51 -0700
Subject: [PATCH] ggml: Export GPU UUIDs

This enables matching up devices and information reported by the backend
with tools (e.g. nvidia-smi) and system management libraries (e.g. nvml).
---
 ggml/src/ggml-cuda/ggml-cuda.cu | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/ggml/src/ggml-cuda/ggml-cuda.cu b/ggml/src/ggml-cuda/ggml-cuda.cu
index 09ce299c..a46dd8be 100644
--- a/ggml/src/ggml-cuda/ggml-cuda.cu
+++ b/ggml/src/ggml-cuda/ggml-cuda.cu
@@ -3565,6 +3565,11 @@ ggml_backend_reg_t ggml_backend_cuda_reg() {
                   );
                 dev_ctx->uuid = uuid;
                 #else
+                #ifdef _WIN32
+                char id[16];
+                snprintf(id, sizeof(id), "%d", i);
+                dev_ctx->uuid = id;
+                #else
                 dev_ctx->uuid = "GPU-" + std::string(prop.uuid.bytes, 16);
                 #endif

