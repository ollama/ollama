# Отчет об анализе CVE уязвимостей в репозитории Ollama

## Дата анализа
30 ноября 2025

## Обзор
Проведен анализ репозитория на предмет наличия CVE уязвимостей в сборке Docker образа, связанных с Go библиотеками и пакетами.

## Выявленные проблемы

### 1. Устаревшие версии базовых образов Docker

#### Проблемы:
- **almalinux:8** - используется в базовых образах (base-amd64, base-arm64)
  - Версия 8 устарела, рекомендуется использовать версию 9 или более новую
  - Может содержать известные CVE в системных пакетах
  
- **ubuntu:25.04** (по умолчанию) - финальный образ
  - Версия может устареть, рекомендуется проверять наличие обновлений безопасности или использовать более свежие релизы (например, 25.10), изменяя `UBUNTU_VERSION`
  - Необходимо регулярно обновлять базовый образ

#### Рекомендации:
- Обновить almalinux:8 до almalinux:9 или использовать более новый LTS релиз
- Использовать конкретные версии тегов вместо latest для воспроизводимости
- Регулярно обновлять базовые образы

### 2. Устаревшие версии Go зависимостей

#### Критические пакеты golang.org/x/*:
- **golang.org/x/crypto v0.36.0** → доступна v0.45.0 (отставание на 9 минорных версий)
- **golang.org/x/net v0.38.0** → доступна v0.47.0 (отставание на 9 минорных версий)
- **golang.org/x/sys v0.36.0** → доступна v0.38.0 (отставание на 2 минорных версии)
- **golang.org/x/text v0.23.0** → доступна v0.31.0 (отставание на 8 минорных версий)

Эти пакеты часто получают исправления безопасности и могут содержать известные CVE.

#### Другие устаревшие зависимости:
- **github.com/gin-gonic/gin v1.10.0** → доступна v1.11.0
- **github.com/containerd/console v1.0.3** → доступна v1.0.5
- **github.com/mattn/go-sqlite3 v1.14.24** → рекомендуется проверить наличие обновлений
- **github.com/google/uuid v1.6.0** → рекомендуется проверить наличие обновлений
- **google.golang.org/protobuf v1.34.1** → рекомендуется проверить наличие обновлений

### 3. Потенциальные проблемы безопасности

#### Известные риски:
1. **golang.org/x/crypto** - криптографические библиотеки часто получают исправления безопасности
2. **golang.org/x/net** - сетевые библиотеки могут содержать уязвимости в обработке протоколов
3. **github.com/mattn/go-sqlite3** - SQLite драйвер может иметь уязвимости в CGO коде
4. **github.com/gin-gonic/gin** - веб-фреймворк может иметь уязвимости в обработке HTTP запросов

### 4. Версия Go

- **go 1.24.1** - используется последняя версия Go, что хорошо
- Рекомендуется регулярно проверять наличие патч-релизов безопасности

## Рекомендации по исправлению

### Немедленные действия:
1. Обновить все пакеты golang.org/x/* до последних версий
2. Обновить базовые образы Docker до более новых версий (теперь по умолчанию используется `UBUNTU_VERSION=25.04`, значение можно повышать при необходимости)
3. Провести полное сканирование уязвимостей с помощью инструментов (govulncheck, trivy, grype)

### Долгосрочные действия:
1. Настроить автоматическое сканирование уязвимостей в CI/CD
2. Регулярно обновлять зависимости (ежемесячно или при выходе критических обновлений)
3. Использовать Dependabot или аналогичные инструменты для автоматического отслеживания обновлений
4. Внедрить политику безопасности зависимостей

## Инструменты для проверки

Рекомендуется использовать следующие инструменты:
- `govulncheck` - официальный инструмент Go для проверки уязвимостей
- `trivy` - сканер уязвимостей для контейнеров и зависимостей
- `grype` - альтернативный сканер уязвимостей
- `snyk` - коммерческий инструмент для проверки зависимостей

## Примечания

- Некоторые зависимости могут быть устаревшими из-за требований совместимости
- Перед обновлением необходимо провести полное тестирование
- Рекомендуется обновлять зависимости постепенно, а не все сразу

## Ответ на вопрос «Будут ли устранены все указанные CVE после переборки образа?»

Нет, простая переборка образа в текущем состоянии репозитория не уберёт все найденные CVE:

- В кодовой базе обновлена только зависимость `github.com/quic-go/quic-go`, поэтому CVE из системных deb-пакетов (tar, pam, coreutils, gnupg2, libgcrypt20, openssl, shadow) и других устаревших Go-зависимостей останутся, если базовые образы и пакеты не обновить. 【F:CVE_ANALYSIS_REPORT.md†L64-L81】【F:CVE_ANALYSIS_REPORT.md†L93-L123】
- Для устранения всех выявленных уязвимостей нужно обновить базовые образы (almalinux/ubuntu), выполнить `apt-get upgrade --only-upgrade` для затронутых пакетов и обновить остальные устаревшие Go-зависимости (особенно `golang.org/x/*`). 【F:CVE_ANALYSIS_REPORT.md†L8-L27】【F:CVE_ANALYSIS_REPORT.md†L33-L63】【F:CVE_ANALYSIS_REPORT.md†L93-L123】

Только после обновления базовых образов, системных пакетов и всех уязвимых зависимостей, а затем повторной сборки, можно ожидать устранения перечисленных CVE.
